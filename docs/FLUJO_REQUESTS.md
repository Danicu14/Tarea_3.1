# ğŸŒ GuÃ­a Visual: Flujo de Requests en el Servidor Web

Este documento explica visualmente cÃ³mo fluyen las peticiones a travÃ©s de la arquitectura Nginx + Gunicorn + FastAPI.

---

## ğŸ“Š Arquitectura Completa

```
                         INTERNET
                            â”‚
                            â”‚ HTTPS (Railway proporciona)
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   RAILWAY     â”‚
                    â”‚  Load Balancerâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP :8000
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      CONTENEDOR DOCKER (Tarea_3.1)    â”‚
        â”‚                                        â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚       SUPERVISORD                â”‚ â”‚
        â”‚  â”‚   (Process Manager)              â”‚ â”‚
        â”‚  â”‚   - Auto-restart                 â”‚ â”‚
        â”‚  â”‚   - Logging                      â”‚ â”‚
        â”‚  â”‚   - Health monitoring            â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚        â”‚                    â”‚          â”‚
        â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚   â”‚  NGINX   â”‚      â”‚  GUNICORN   â”‚  â”‚
        â”‚   â”‚  :8000   â”‚â—„â”€â”€â”€â”€â”€â”¤  :8001      â”‚  â”‚
        â”‚   â”‚          â”‚      â”‚             â”‚  â”‚
        â”‚   â”‚ Proxy +  â”‚      â”‚ 4-5 Workers â”‚  â”‚
        â”‚   â”‚ Static   â”‚      â”‚ (Uvicorn)   â”‚  â”‚
        â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚        â”‚ /static           â”‚ /api     â”‚
        â”‚        â”‚                   â”‚          â”‚
        â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚   â”‚  HTML     â”‚      â”‚  FastAPI   â”‚  â”‚
        â”‚   â”‚  CSS      â”‚      â”‚  App       â”‚  â”‚
        â”‚   â”‚  JS       â”‚      â”‚            â”‚  â”‚
        â”‚   â”‚  Images   â”‚      â”‚  Endpoints â”‚  â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo Detallado de Requests

### Caso 1: Request de Archivo EstÃ¡tico (Frontend)

**Ejemplo:** `GET /css/style.css`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENTE   â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. GET /css/style.css
       â”‚    Accept-Encoding: gzip
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            RAILWAY :443                   â”‚
â”‚  - Termina SSL/TLS                       â”‚
â”‚  - Forward a contenedor                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. GET /css/style.css (HTTP)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            NGINX :8000                    â”‚
â”‚                                           â”‚
â”‚  3. Analiza ruta: /css/style.css         â”‚
â”‚     â”œâ”€ Match: location ~* \.css$         â”‚
â”‚     â””â”€ root: /app/static                 â”‚
â”‚                                           â”‚
â”‚  4. Busca archivo:                       â”‚
â”‚     /app/static/css/style.css            â”‚
â”‚     â”œâ”€ Archivo existe âœ…                 â”‚
â”‚     â””â”€ TamaÃ±o: 25 KB                     â”‚
â”‚                                           â”‚
â”‚  5. Aplica optimizaciones:               â”‚
â”‚     â”œâ”€ Comprime con GZIP (nivel 6)      â”‚
â”‚     â”‚  â””â”€ 25 KB â†’ 6 KB (76% reducciÃ³n)  â”‚
â”‚     â”œâ”€ AÃ±ade headers:                    â”‚
â”‚     â”‚  â”œâ”€ Content-Encoding: gzip        â”‚
â”‚     â”‚  â”œâ”€ Cache-Control: max-age=604800 â”‚
â”‚     â”‚  â”œâ”€ X-Content-Type-Options: nosniffâ”‚
â”‚     â”‚  â””â”€ Expires: +7 dÃ­as              â”‚
â”‚     â””â”€ Content-Type: text/css            â”‚
â”‚                                           â”‚
â”‚  6. EnvÃ­a respuesta                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 200 OK
       â”‚ Content-Length: 6144 bytes
       â”‚ Content-Encoding: gzip
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENTE    â”‚
â”‚              â”‚
â”‚  7. Recibe y cachea por 7 dÃ­as          â”‚
â”‚     - Descomprime GZIP                   â”‚
â”‚     - Aplica estilos                     â”‚
â”‚     - Guarda en cache del browser        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â±ï¸  TIEMPO TOTAL: ~5-10 ms
ğŸ’¾  DATOS TRANSFERIDOS: 6 KB (vs 25 KB sin GZIP)
```

**PrÃ³ximas requests dentro de 7 dÃ­as:**
```
Cliente â†’ Cache local âœ… (0 ms, 0 bytes transferidos)
```

---

### Caso 2: Request de API (Backend)

**Ejemplo:** `GET /api/items`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENTE   â”‚
â”‚   (fetch)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. GET /api/items
       â”‚    Accept: application/json
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            RAILWAY :443                   â”‚
â”‚  - Termina SSL/TLS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. GET /api/items (HTTP)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            NGINX :8000                    â”‚
â”‚                                           â”‚
â”‚  3. Analiza ruta: /api/items             â”‚
â”‚     â”œâ”€ Match: location /api              â”‚
â”‚     â””â”€ AcciÃ³n: proxy_pass                â”‚
â”‚                                           â”‚
â”‚  4. Selecciona conexiÃ³n:                 â”‚
â”‚     â”œâ”€ Pool keep-alive (32 conexiones)  â”‚
â”‚     â”œâ”€ ConexiÃ³n disponible? âœ…           â”‚
â”‚     â””â”€ Reutiliza conexiÃ³n TCP            â”‚
â”‚        (ahorra ~20ms de handshake)       â”‚
â”‚                                           â”‚
â”‚  5. AÃ±ade headers de proxy:              â”‚
â”‚     â”œâ”€ X-Real-IP: 203.0.113.42          â”‚
â”‚     â”œâ”€ X-Forwarded-For: 203.0.113.42    â”‚
â”‚     â”œâ”€ X-Forwarded-Proto: https          â”‚
â”‚     â””â”€ Host: tu-app.railway.app          â”‚
â”‚                                           â”‚
â”‚  6. Proxy pass â†’                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GET /api/items
       â”‚ (conexiÃ³n TCP local)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GUNICORN :8001                    â”‚
â”‚                                           â”‚
â”‚  7. Load balancer interno:               â”‚
â”‚                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚Worker 1 â”‚  â”‚Worker 2 â”‚            â”‚
â”‚     â”‚  BUSY   â”‚  â”‚  FREE âœ…â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”            â”‚
â”‚     â”‚Worker 3 â”‚  â”‚Worker 4 â”‚            â”‚
â”‚     â”‚  BUSY   â”‚  â”‚  BUSY   â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                           â”‚
â”‚  8. Worker 2 procesa request             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Entrega request a FastAPI
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FASTAPI (Uvicorn)               â”‚
â”‚                                           â”‚
â”‚  9. Routing:                             â”‚
â”‚     @app.get("/api/items")               â”‚
â”‚     â””â”€ async def get_items()             â”‚
â”‚                                           â”‚
â”‚  10. Ejecuta lÃ³gica:                     â”‚
â”‚     â”œâ”€ Query a DB (si aplica)           â”‚
â”‚     â”œâ”€ Procesa datos                     â”‚
â”‚     â””â”€ Valida con Pydantic               â”‚
â”‚                                           â”‚
â”‚  11. Genera respuesta:                   â”‚
â”‚     {                                     â”‚
â”‚       "items": [                          â”‚
â”‚         {"id": 1, "name": "Item 1"},     â”‚
â”‚         {"id": 2, "name": "Item 2"}      â”‚
â”‚       ]                                   â”‚
â”‚     }                                     â”‚
â”‚                                           â”‚
â”‚  12. Retorna JSON                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 200 OK + JSON
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GUNICORN :8001                    â”‚
â”‚                                           â”‚
â”‚  13. Worker 2 envÃ­a respuesta a Nginx    â”‚
â”‚     â””â”€ Worker queda libre para prÃ³xima   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 200 OK + JSON
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            NGINX :8000                    â”‚
â”‚                                           â”‚
â”‚  14. Proxy buffering:                    â”‚
â”‚     â”œâ”€ Lee toda la respuesta rÃ¡pido      â”‚
â”‚     â”‚  (libera worker de Gunicorn)       â”‚
â”‚     â”œâ”€ Bufferea en memoria               â”‚
â”‚     â””â”€ EnvÃ­a al cliente a su ritmo       â”‚
â”‚                                           â”‚
â”‚  15. AÃ±ade headers:                      â”‚
â”‚     â”œâ”€ Cache-Control: no-cache           â”‚
â”‚     â”œâ”€ Content-Type: application/json    â”‚
â”‚     â””â”€ Security headers                  â”‚
â”‚                                           â”‚
â”‚  16. EnvÃ­a respuesta                     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 200 OK
       â”‚ {"items": [...]}
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENTE    â”‚
â”‚              â”‚
â”‚  17. JavaScript procesa JSON             â”‚
â”‚      - Actualiza DOM                     â”‚
â”‚      - Renderiza items                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â±ï¸  TIEMPO TOTAL: ~50-200 ms
   â”œâ”€ Nginx: ~5 ms
   â”œâ”€ Gunicorn routing: ~5 ms
   â”œâ”€ FastAPI logic: ~40-180 ms (depende de lÃ³gica)
   â””â”€ Buffering/transfer: ~10 ms
```

---

## ğŸ§ª Caso 3: Health Check (Monitoring)

**Ejemplo:** `GET /health`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RAILWAY   â”‚
â”‚ Health Checkâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Cada 30 segundos
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            NGINX :8000                    â”‚
â”‚                                           â”‚
â”‚  location /health {                      â”‚
â”‚    proxy_pass http://gunicorn_backend;   â”‚
â”‚    access_log off;  â† No loguear        â”‚
â”‚  }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GUNICORN :8001                    â”‚
â”‚  - Worker disponible procesa             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FASTAPI                         â”‚
â”‚                                           â”‚
â”‚  @app.get("/health")                     â”‚
â”‚  def health_check():                     â”‚
â”‚    return {                               â”‚
â”‚      "status": "healthy",                â”‚
â”‚      "environment": "production"          â”‚
â”‚    }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ {"status": "healthy"}
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RAILWAY    â”‚
â”‚              â”‚
â”‚  âœ… HEALTHY  â”‚
â”‚  â†’ Mantiene contenedor activo            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â±ï¸  TIEMPO: <10 ms
ğŸ”„  FRECUENCIA: Cada 30s
ğŸ“  LOGGING: Deshabilitado (no contamina logs)
```

---

## ğŸš¨ Caso 4: Fallo y Recovery (Alta Disponibilidad)

**Escenario:** Worker de Gunicorn crashea

```
TIEMPO: T0 - OperaciÃ³n normal
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GUNICORN                          â”‚
â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Worker 1 â”‚  â”‚Worker 2 â”‚               â”‚
â”‚  â”‚  âœ…     â”‚  â”‚  âœ…     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Worker 3 â”‚  â”‚Worker 4 â”‚               â”‚
â”‚  â”‚  âœ…     â”‚  â”‚  âœ…     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â†“ Request pesado causa crash

TIEMPO: T1 - Worker 2 crashea
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GUNICORN                          â”‚
â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Worker 1 â”‚  â”‚Worker 2 â”‚               â”‚
â”‚  â”‚  âœ…     â”‚  â”‚  âŒğŸ’¥   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Worker 3 â”‚  â”‚Worker 4 â”‚               â”‚
â”‚  â”‚  âœ…     â”‚  â”‚  âœ…     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                           â”‚
â”‚  Gunicorn detecta crash                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â†“ 1-2 segundos

TIEMPO: T2 - Gunicorn reinicia worker
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GUNICORN                          â”‚
â”‚                                           â”‚
â”‚  [LOG] Worker 2 (pid: 1234) died          â”‚
â”‚  [LOG] Spawning new worker...             â”‚
â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Worker 1 â”‚  â”‚Worker 2'â”‚               â”‚
â”‚  â”‚  âœ…     â”‚  â”‚  ğŸ”„     â”‚ â† Reiniciandoâ”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Worker 3 â”‚  â”‚Worker 4 â”‚               â”‚
â”‚  â”‚  âœ…     â”‚  â”‚  âœ…     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                           â”‚
â”‚  Capacidad: 75% (3 de 4 workers)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â†“ 2-5 segundos

TIEMPO: T3 - Worker recuperado
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GUNICORN                          â”‚
â”‚                                           â”‚
â”‚  [LOG] New worker spawned (pid: 5678)     â”‚
â”‚  [LOG] Worker ready to handle requests    â”‚
â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Worker 1 â”‚  â”‚Worker 2'â”‚               â”‚
â”‚  â”‚  âœ…     â”‚  â”‚  âœ…     â”‚ â† Recuperado â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Worker 3 â”‚  â”‚Worker 4 â”‚               â”‚
â”‚  â”‚  âœ…     â”‚  â”‚  âœ…     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                           â”‚
â”‚  Capacidad: 100% (4 de 4 workers) âœ…     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â±ï¸  DOWNTIME: 0 segundos (otros workers continuaron)
ğŸ¯  CAPACIDAD: 75% â†’ 100% en 3-7 segundos
ğŸ”„  AUTOMÃTICO: Sin intervenciÃ³n manual
```

---

## ğŸ“Š Caso 5: Alta Carga (Load Balancing)

**Escenario:** 100 requests simultÃ¡neos

```
100 REQUESTS LLEGAN
       â”‚
       â”‚  Todos a Nginx :8000
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            NGINX                          â”‚
â”‚                                           â”‚
â”‚  Queue de conexiones:                    â”‚
â”‚  [R1][R2][R3]...[R100]                   â”‚
â”‚                                           â”‚
â”‚  worker_connections: 1024                 â”‚
â”‚  Acepta todas âœ…                         â”‚
â”‚                                           â”‚
â”‚  Routing:                                â”‚
â”‚  â”œâ”€ 60 requests â†’ /static (Nginx)       â”‚
â”‚  â””â”€ 40 requests â†’ /api (Gunicorn)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ 60 estÃ¡ticos    â”‚ 40 API
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NGINX      â”‚   â”‚    GUNICORN         â”‚
â”‚   (I/O)      â”‚   â”‚                     â”‚
â”‚              â”‚   â”‚  4 Workers          â”‚
â”‚  Procesa     â”‚   â”‚  Distribuye:        â”‚
â”‚  60 requests â”‚   â”‚   W1: 10 requests   â”‚
â”‚  en paralelo â”‚   â”‚   W2: 10 requests   â”‚
â”‚              â”‚   â”‚   W3: 10 requests   â”‚
â”‚  ~5ms cada   â”‚   â”‚   W4: 10 requests   â”‚
â”‚  uno         â”‚   â”‚                     â”‚
â”‚              â”‚   â”‚  ~50ms cada uno     â”‚
â”‚              â”‚   â”‚                     â”‚
â”‚  TOTAL: ~5ms â”‚   â”‚  TOTAL: ~50ms       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULTADOS:
â”œâ”€ 60 estÃ¡ticos: TODOS en ~5ms âœ…
â””â”€ 40 API: TODOS en ~50ms âœ…

Sin Gunicorn (single process):
â””â”€ 40 API: 40 Ã— 50ms = 2000ms (2s) âŒ

CON GUNICORN: 10x MÃS RÃPIDO
```

---

## ğŸ¯ Resumen de Beneficios Visualizados

### 1. **SeparaciÃ³n de Responsabilidades**

```
SIN NGINX (Todo en FastAPI/Uvicorn):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        UVICORN              â”‚
â”‚  - EstÃ¡ticos âŒ (lento)     â”‚
â”‚  - API âœ…                   â”‚
â”‚  - CompresiÃ³n âŒ            â”‚
â”‚  - Cache âŒ                 â”‚
â”‚  - Proxy âŒ                 â”‚
â”‚  - Security headers âš ï¸      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CON NGINX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NGINX      â”‚  â”‚   GUNICORN   â”‚
â”‚ - EstÃ¡ticos âœ…â”‚  â”‚ - API âœ…     â”‚
â”‚ - CompresiÃ³n âœ…â”‚  â”‚ - LÃ³gica âœ…  â”‚
â”‚ - Cache âœ…    â”‚  â”‚ - DB âœ…      â”‚
â”‚ - Proxy âœ…    â”‚  â”‚              â”‚
â”‚ - Security âœ… â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **Performance**

| OperaciÃ³n | Sin Nginx | Con Nginx | Mejora |
|-----------|-----------|-----------|--------|
| Servir HTML | 50ms | 5ms | **10x** |
| Servir CSS/JS | 50ms | 5ms | **10x** |
| API request | 50ms | 40ms | **1.25x** |
| Concurrencia | 100 req/s | 500 req/s | **5x** |

### 3. **Alta Disponibilidad**

```
SUPERVISORD monitoreando:

Nginx crashea â†’ Reinicia en 1s
Gunicorn crashea â†’ Reinicia en 1s
Worker crashea â†’ Nuevo worker en 3s

UPTIME TEÃ“RICO: 99.9%+
```

---

## ğŸ” Debugging Tips

### Ver logs en tiempo real:

```bash
# Todos los logs
docker logs -f fastapi-nginx-prod

# Solo Nginx
docker exec fastapi-nginx-prod tail -f /var/log/nginx/access.log

# Solo Gunicorn
docker exec fastapi-nginx-prod supervisorctl tail gunicorn
```

### Verificar que Nginx estÃ¡ corriendo:

```bash
docker exec fastapi-nginx-prod ps aux | grep nginx
```

### Verificar workers de Gunicorn:

```bash
docker exec fastapi-nginx-prod ps aux | grep gunicorn
```

### Test manual de endpoints:

```bash
# EstÃ¡tico (debe ser rÃ¡pido, <10ms)
curl -w "\nTime: %{time_total}s\n" http://localhost:8000/

# API (puede ser mÃ¡s lento, ~50-200ms)
curl -w "\nTime: %{time_total}s\n" http://localhost:8000/api/info
```

---

**Este documento complementa:** [ENTREGA_PARTE3.md](../ENTREGA_PARTE3.md)
